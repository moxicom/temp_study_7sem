= ((($A103*A101)+(1-A101)*(1-$A103))* (($B103*B101)+(1-B101)*(1-$B103)) *(($C103*C101)+(1-C101)*(1-$C103))* (($D103*D101)+(1-$D$2)*(1-$D103))* (($E103*E101)+(1-E101)*(1-$E103))*(($F103*F101)+(1-F101)*(1-$F103))*(($G103*G101)+(1-G101)*(1-$G103)))*$I103

# Simple API Service для нагрузочного тестирования


### Требования

- Go 1.21 или выше
- k6 (для нагрузочного тестирования)

### Установка зависимостей

```bash
go mod download
```

### Запуск сервера

```bash
go run main.go
```

Сервер запустится на порту `8080`.


### Swagger документация
```
GET /swagger
```
Интерактивная Swagger UI документация.

```
GET /swagger.json
```
OpenAPI спецификация в формате JSON.

### k6
```bash
sudo gpg -k
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6
```

## Запуск нагрузочного тестирования

### Базовый запуск
```bash
k6 run k6_test.js
```

### С кастомным URL
```bash
BASE_URL=http://localhost:8080/api/v1 k6 run k6_test.js
```

### С дополнительными опциями
```bash
k6 run --vus 10 --duration 30s k6_test.js
```

### Запуск с выводом в файл
```bash
k6 run k6_test.js --out json=results.json
```

## Параметры тестирования

Скрипт `k6_test.js` настроен на следующие сценарии:

1. **10 VUs на 30 секунд** - умеренная нагрузка
2. **50 VUs на 10 секунд** - пиковая нагрузка
3. **Плавное снижение** - завершение теста

### Thresholds (пороги)

- Процент ошибок должен быть меньше 1%
- 95% запросов должны выполняться быстрее 500ms
- 99% запросов должны выполняться быстрее 1000ms

## Анализ результатов

После выполнения теста k6 выведет следующую информацию:

- **Количество запросов** - общее количество выполненных HTTP запросов
- **Время ответа** - статистика по времени ответа (среднее, медиана, P95, P99, мин, макс)
- **Процент ошибок** - процент неуспешных запросов
- **Пропускная способность** - количество запросов в секунду (RPS)

### Пример вывода

```
=== Тест завершен ===

Общая статистика:
  Длительность теста: 50s
  Всего запросов: 2500
  Успешных запросов: 2500

Время ответа:
  Среднее: 15.23ms
  Медиана: 12.45ms
  P95: 45.67ms
  P99: 89.12ms
  Минимум: 5.23ms
  Максимум: 156.78ms

Процент ошибок: 0.00%
  Всего ошибок: 0

Пропускная способность: 50.00 запросов/сек
```

## Цели тестирования

### Пропускная способность (Throughput)
- **Что проверяем**: Сколько запросов в секунду может обработать сервис
- **Метрика**: RPS (Requests Per Second)
- **Ожидаемый результат**: Сервис должен обрабатывать минимум 50+ запросов/сек

### Устойчивость (Stability)
- **Что проверяем**: Способность сервиса работать стабильно под нагрузкой
- **Метрика**: Процент ошибок, время ответа
- **Ожидаемый результат**: Процент ошибок < 1%, стабильное время ответа

### Производительность (Performance)
- **Что проверяем**: Скорость обработки запросов
- **Метрика**: Время ответа (latency)
- **Ожидаемый результат**: P95 < 500ms, P99 < 1000ms

### Масштабируемость (Scalability)
- **Что проверяем**: Поведение сервиса при увеличении нагрузки
- **Метрика**: Изменение времени ответа и процента ошибок при росте VUs
- **Ожидаемый результат**: Время ответа не должно значительно увеличиваться

## Структура проекта

```
.
├── main.go          # Основной файл сервера
├── go.mod           # Go модуль с зависимостями
├── k6_test.js       # Скрипт для k6 нагрузочного тестирования
└── README.md        # Документация
```

## Примеры использования API

### Health Check
```bash
curl http://localhost:8080/api/v1/health
```

### Получить все элементы
```bash
curl http://localhost:8080/api/v1/items
```

### Получить элемент по ID
```bash
curl http://localhost:8080/api/v1/items/1
```

### Получить количество элементов
```bash
curl http://localhost:8080/api/v1/items/count
```

## Примечания

- Все данные хранятся в памяти и не сохраняются после перезапуска сервиса
- Сервис инициализируется с 10 тестовыми элементами
- Для production использования рекомендуется добавить персистентное хранилище

